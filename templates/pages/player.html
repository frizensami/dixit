{% extends 'layouts/main.html' %}
{% block title %}{{playerid}}{% endblock %}
{% block content %}

<script type="text/javascript" charset="utf-8">
    function change_header(new_content) {
        document.getElementById("header").innerHTML = new_content;
    }

    function get_img_url(img_num) {
        return 'http://' + document.domain + ':' + location.port + "/img/" + img_num
    }

    function set_image(element_id, img_num) {
        document.getElementById(element_id).src = get_img_url(img_num)
    }

    function set_deck(images_list) {
        // assume images_list is like: [2, 5, 16, 20, 3] - load those images with get_img_url
        for (var i = 0; i < 6; i++) {
            set_image('c' + i, images_list[i]);
        }
    }

    function set_others(images_list) {
        // assume images_list is like: [2, 5, 16, 20, 3] - load those images with get_img_url
        for (var i = 0; i < 2; i++) {
            set_image('o' + i, images_list[i]);
        }
    }



</script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
<script type="text/javascript" charset="utf-8">
    var socket = io.connect('http://' + document.domain + ':' + location.port);
    var my_id = {{playerid}};
    var current_player_id = -1;

    socket.on('connect', function() {
        console.log("Connected to server!");
        socket.emit('join', {playerid: my_id});
    });

    socket.on('disconnect', function() {
        console.log("disconnected!");
    });

    socket.on('start', function(data) {
        console.log(data);
        current_player_id = data["starting_player"];
        set_deck(data[my_id]);

        if (current_player_id == my_id) {
            change_header("Please enter a <b> topic </b> and click on a <b> card from your deck </b>");
        } else {
            change_header("<b>Waiting for Player " + data["starting_player"] + " (not you) to select a topic and card</b>");
        }

    });


    function card_clicked(card_index) {
        console.log("Card clicked: " + card_index);
        socket.emit('card_clicked', {playerid: my_id, cardid: card_index});
    }

    function submit_topic() {
        var topic_text = document.getElementById('topic').value;
        console.log("Entering topic: " + topic_text);
        socket.emit('new_topic', {playerid: my_id, topictext: topic_text});
    }


</script>

<center>
      <h1 id="header">Game has not started</h1>


      <div class="page-header">
          <h2 id="header">Cards selected by other players</h2>

          </div>


          <input id='o0' onclick=card_clicked('o0') type="image" width="13%">
          <input id='o1' onclick=card_clicked('o1') type="image" width="13%">



  <div class="page-header">
    <h2 id="header">Enter a topic (if it's your turn)</h2>
    </div>

    <input id="topic" type="text" name="topic" value="">

    <br>
    <br>

    <div class="btn-toolbar" role="group" aria-label="...">
      <button onclick=submit_topic() class="btn btn-success" role="button">Submit Topic</button>
      </div>

          <div class="page-header">
            <h2 id="header">Your Deck</h2>
          </div>

          <input id='c0' onclick=card_clicked('c0') type="image" width="16%">
          <input id='c1' onclick=card_clicked('c1') type="image" width="16%">
          <input id='c2' onclick=card_clicked('c2') type="image" width="16%">
          <input id='c3' onclick=card_clicked('c3') type="image" width="16%">
          <input id='c4' onclick=card_clicked('c4') type="image" width="16%">
          <input id='c5' onclick=card_clicked('c5') type="image" width="16%">

          <script>

            set_image('c0', 0);
            set_image('c1', 0);
            set_image('c2', 0);
            set_image('c3', 0);
            set_image('c4', 0);
            set_image('c5', 0);
            set_image('o0', 0);
            set_image('o1', 0);

            //set_deck([2, 3, 4, 5, 6, 7]);
            //set_others([10,11]);

        </script>


</center>
        {% endblock %}
